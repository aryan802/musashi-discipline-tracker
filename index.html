<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Musashi's Five Rings - Local Discipline Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab-btn.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .tab-btn:hover {
            transform: translateY(-2px);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card h3 {
            margin-bottom: 20px;
            color: #4ecdc4;
            font-size: 1.3rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #b0b0b0;
        }

        input[type="text"], input[type="time"], textarea, select {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 14px;
        }

        input[type="text"]:focus, input[type="time"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 0 2px rgba(78, 205, 196, 0.2);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: transform 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 12px;
        }

        .time-entry {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #4ecdc4;
        }

        .time-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .time-range {
            font-weight: bold;
            color: #4ecdc4;
        }

        .activity {
            color: #ffffff;
            font-weight: 500;
        }

        .note {
            color: #b0b0b0;
            font-style: italic;
            margin-top: 5px;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }

        .calendar-header {
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            font-weight: bold;
        }

        .calendar-day {
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .calendar-day:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .calendar-day.selected {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .calendar-day.has-data {
            border: 2px solid #4ecdc4;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(45deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #4ecdc4;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #b0b0b0;
            font-size: 0.9rem;
        }

        .month-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .month-nav button {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
        }

        .wind-ring-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            z-index: 1000;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1a1a2e;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
        }

        .close:hover {
            color: #fff;
        }

        .ring-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .earth { background-color: #8B4513; }
        .water { background-color: #4169E1; }
        .fire { background-color: #FF4500; }
        .wind { background-color: #228B22; }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .nav-tabs {
                gap: 5px;
            }
            
            .tab-btn {
                padding: 10px 16px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🗾 Musashi's Five Rings</h1>
            <p>Local Discipline Tracking System</p>
        </div>

        <div class="nav-tabs">
            <button class="tab-btn active" onclick="showTab('calendar')">📅 Calendar</button>
            <button class="tab-btn" onclick="showTab('earth')"><span class="ring-indicator earth"></span>Earth Ring</button>
            <button class="tab-btn" onclick="showTab('water')"><span class="ring-indicator water"></span>Water Ring</button>
            <button class="tab-btn" onclick="showTab('fire')"><span class="ring-indicator fire"></span>Fire Ring</button>
            <button class="tab-btn" onclick="showTab('notes')">📖 View Notes</button>
        </div>

        <button class="wind-ring-toggle" onclick="openWindModal()">💨 Wind Ring</button>

        <!-- Calendar Tab -->
        <div id="calendar" class="tab-content active">
            <div class="card">
                <h3>📅 Calendar Navigation</h3>
                <div class="month-nav">
                    <button onclick="changeMonth(-1)">← Previous</button>
                    <h3 id="currentMonth"></h3>
                    <button onclick="changeMonth(1)">Next →</button>
                </div>
                <div class="calendar" id="calendarGrid"></div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalDays">0</div>
                    <div class="stat-label">Days Tracked</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgProductivity">0%</div>
                    <div class="stat-label">Avg Productivity</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalGoals">0</div>
                    <div class="stat-label">Total Goals Set</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="windEntries">0</div>
                    <div class="stat-label">Wind Ring Entries</div>
                </div>
            </div>
        </div>

        <!-- Earth Ring Tab -->
        <div id="earth" class="tab-content">
            <div class="card">
                <h3>🌍 Earth Ring - Time Tracking for <span id="earthDate"></span></h3>
                
                <div class="form-group">
                    <label>From Time:</label>
                    <input type="time" id="fromTime" required>
                </div>
                
                <div class="form-group">
                    <label>To Time:</label>
                    <input type="time" id="toTime" required>
                </div>
                
                <div class="form-group">
                    <label>Activity:</label>
                    <input type="text" id="activity" placeholder="What did you do?" required>
                </div>
                
                <div class="form-group">
                    <label>Category:</label>
                    <select id="category">
                        <option value="productive">Productive</option>
                        <option value="waste">Time Waste</option>
                        <option value="necessary">Necessary (meals, sleep, etc.)</option>
                        <option value="maintenance">Life Maintenance</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Optimization Note:</label>
                    <textarea id="optimizationNote" placeholder="How could this time be optimized? Or should it be ignored?"></textarea>
                </div>
                
                <button class="btn" onclick="addTimeEntry()">Add Time Entry</button>
            </div>

            <div class="card">
                <h3>Today's Time Entries</h3>
                <div id="timeEntriesList"></div>
            </div>
        </div>

        <!-- Water Ring Tab -->
        <div id="water" class="tab-content">
            <div class="card">
                <h3>💧 Water Ring - End of Day Review for <span id="waterDate"></span></h3>
                
                <div class="form-group">
                    <label>Tomorrow's Micro Goals:</label>
                    <textarea id="microGoals" placeholder="List small, achievable goals for tomorrow..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>What should I adapt tomorrow?</label>
                    <textarea id="adaptations" placeholder="What didn't work today? How will you flow around obstacles?"></textarea>
                </div>
                
                <div class="form-group">
                    <label>Small wins from today:</label>
                    <textarea id="smallWins" placeholder="Celebrate the micro victories..."></textarea>
                </div>
                
                <button class="btn" onclick="saveWaterRing()">Save Water Ring Review</button>
            </div>

            <div class="card">
                <h3>Previous Reviews</h3>
                <div id="waterReviews"></div>
            </div>
        </div>

        <!-- Fire Ring Tab -->
        <div id="fire" class="tab-content">
            <div class="card">
                <h3>🔥 Fire Ring - Daily Fuel for <span id="fireDate"></span></h3>
                
                <div class="form-group">
                    <label>What frustrated/angered you today?</label>
                    <textarea id="frustrations" placeholder="Channel this emotion into fuel..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>How will you attack your weaknesses tomorrow?</label>
                    <textarea id="attackPlan" placeholder="Turn that anger into action..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Emotional fuel notes:</label>
                    <textarea id="emotionalNotes" placeholder="Transform negative energy into progress..."></textarea>
                </div>
                
                <button class="btn" onclick="saveFireRing()">Save Fire Ring</button>
            </div>

            <div class="card">
                <h3>Previous Fire Ring Entries</h3>
                <div id="fireEntries"></div>
            </div>
        </div>

        <!-- Notes Tab -->
        <div id="notes" class="tab-content">
            <div class="card">
                <h3>📖 View Notes by Date</h3>
                <input type="date" id="notesDate" onchange="loadNotesForDate()">
                <div id="notesDisplay"></div>
            </div>
        </div>
    </div>

    <!-- Wind Ring Modal -->
    <div id="windModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeWindModal()">&times;</span>
            <h3>💨 Wind Ring - Complacency Check</h3>
            <div class="form-group">
                <label>What complacent behavior did you notice?</label>
                <textarea id="complacencyNote" placeholder="Be honest about where you got comfortable..."></textarea>
            </div>
            <div class="form-group">
                <label>Enlightenment/Realization:</label>
                <textarea id="windRealization" placeholder="What did you learn from this moment of awareness?"></textarea>
            </div>
            <button class="btn" onclick="saveWindRing()">Save Wind Ring Entry</button>
        </div>
    </div>

    <script>
        // Global variables
        let selectedDate = new Date();
        let currentMonth = new Date();

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            updateDateDisplays();
            renderCalendar();
            updateStats();
            loadTodaysData();
        });

        // Tab management
        function showTab(tabName) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Load data for specific tabs
            if (tabName === 'earth') loadTimeEntries();
            if (tabName === 'water') loadWaterReviews();
            if (tabName === 'fire') loadFireEntries();
        }

        // Date management
        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        function updateDateDisplays() {
            const dateStr = formatDate(selectedDate);
            document.getElementById('earthDate').textContent = dateStr;
            document.getElementById('waterDate').textContent = dateStr;
            document.getElementById('fireDate').textContent = dateStr;
            document.getElementById('notesDate').value = dateStr;
        }

        // Calendar functions
        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const monthYear = document.getElementById('currentMonth');
            
            monthYear.textContent = currentMonth.toLocaleDateString('en-US', { 
                month: 'long', 
                year: 'numeric' 
            });
            
            grid.innerHTML = '';
            
            // Add day headers
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            days.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-header';
                header.textContent = day;
                grid.appendChild(header);
            });
            
            // Get first day of month and number of days
            const firstDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), 1);
            const lastDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            // Add calendar days
            for (let i = 0; i < 42; i++) {
                const day = new Date(startDate);
                day.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day.getDate();
                
                if (day.getMonth() !== currentMonth.getMonth()) {
                    dayElement.style.opacity = '0.3';
                }
                
                if (formatDate(day) === formatDate(selectedDate)) {
                    dayElement.classList.add('selected');
                }
                
                if (hasDataForDate(formatDate(day))) {
                    dayElement.classList.add('has-data');
                }
                
                dayElement.onclick = () => {
                    selectedDate = new Date(day);
                    updateDateDisplays();
                    renderCalendar();
                    loadTodaysData();
                };
                
                grid.appendChild(dayElement);
            }
        }

        function changeMonth(direction) {
            currentMonth.setMonth(currentMonth.getMonth() + direction);
            renderCalendar();
        }

        function hasDataForDate(dateStr) {
            const data = localStorage.getItem(`musashi_${dateStr}`);
            return data !== null;
        }

        // Earth Ring - Time Tracking
        function addTimeEntry() {
            const fromTime = document.getElementById('fromTime').value;
            const toTime = document.getElementById('toTime').value;
            const activity = document.getElementById('activity').value;
            const category = document.getElementById('category').value;
            const note = document.getElementById('optimizationNote').value;
            
            if (!fromTime || !toTime || !activity) {
                alert('Please fill in all required fields');
                return;
            }
            
            const dateStr = formatDate(selectedDate);
            let dayData = JSON.parse(localStorage.getItem(`musashi_${dateStr}`) || '{}');
            
            if (!dayData.timeEntries) dayData.timeEntries = [];
            
            const entry = {
                id: Date.now(),
                fromTime,
                toTime,
                activity,
                category,
                note,
                duration: calculateDuration(fromTime, toTime)
            };
            
            dayData.timeEntries.push(entry);
            localStorage.setItem(`musashi_${dateStr}`, JSON.stringify(dayData));
            
            // Clear form
            document.getElementById('fromTime').value = '';
            document.getElementById('toTime').value = '';
            document.getElementById('activity').value = '';
            document.getElementById('optimizationNote').value = '';
            
            loadTimeEntries();
            renderCalendar();
            updateStats();
        }

        function calculateDuration(from, to) {
            const fromMinutes = timeToMinutes(from);
            const toMinutes = timeToMinutes(to);
            let diff = toMinutes - fromMinutes;
            if (diff < 0) diff += 24 * 60; // Handle overnight
            return diff;
        }

        function timeToMinutes(time) {
            const [hours, minutes] = time.split(':').map(Number);
            return hours * 60 + minutes;
        }

        function loadTimeEntries() {
            const dateStr = formatDate(selectedDate);
            const dayData = JSON.parse(localStorage.getItem(`musashi_${dateStr}`) || '{}');
            const container = document.getElementById('timeEntriesList');
            
            if (!dayData.timeEntries || dayData.timeEntries.length === 0) {
                container.innerHTML = '<p style="color: #666;">No time entries for this day</p>';
                return;
            }
            
            container.innerHTML = dayData.timeEntries.map(entry => `
                <div class="time-entry">
                    <div class="time-entry-header">
                        <div>
                            <span class="time-range">${entry.fromTime} - ${entry.toTime}</span>
                            <span class="activity">${entry.activity}</span>
                        </div>
                        <div>
                            <span style="color: ${getCategoryColor(entry.category)}">${entry.category}</span>
                            <span style="margin-left: 10px;">${Math.floor(entry.duration / 60)}h ${entry.duration % 60}m</span>
                            <button class="btn btn-danger btn-small" onclick="deleteTimeEntry('${dateStr}', ${entry.id})">Delete</button>
                        </div>
                    </div>
                    ${entry.note ? `<div class="note">💡 ${entry.note}</div>` : ''}
                </div>
            `).join('');
        }

        function getCategoryColor(category) {
            const colors = {
                'productive': '#4ecdc4',
                'waste': '#ff6b6b',
                'necessary': '#ffa726',
                'maintenance': '#9c27b0'
            };
            return colors[category] || '#666';
        }

        function deleteTimeEntry(dateStr, entryId) {
            if (!confirm('Delete this time entry?')) return;
            
            let dayData = JSON.parse(localStorage.getItem(`musashi_${dateStr}`) || '{}');
            if (dayData.timeEntries) {
                dayData.timeEntries = dayData.timeEntries.filter(entry => entry.id !== entryId);
                localStorage.setItem(`musashi_${dateStr}`, JSON.stringify(dayData));
                loadTimeEntries();
                renderCalendar();
                updateStats();
            }
        }

        // Water Ring
        function saveWaterRing() {
            const microGoals = document.getElementById('microGoals').value;
            const adaptations = document.getElementById('adaptations').value;
            const smallWins = document.getElementById('smallWins').value;
            
            const dateStr = formatDate(selectedDate);
            let dayData = JSON.parse(localStorage.getItem(`musashi_${dateStr}`) || '{}');
            
            dayData.waterRing = {
                microGoals,
                adaptations,
                smallWins,
                timestamp: new Date().toLocaleString()
            };
            
            localStorage.setItem(`musashi_${dateStr}`, JSON.stringify(dayData));
            
            document.getElementById('microGoals').value = '';
            document.getElementById('adaptations').value = '';
            document.getElementById('smallWins').value = '';
            
            alert('Water Ring review saved!');
            loadWaterReviews();
            renderCalendar();
            updateStats();
        }

        function loadWaterReviews() {
            const dateStr = formatDate(selectedDate);
            const dayData = JSON.parse(localStorage.getItem(`musashi_${dateStr}`) || '{}');
            const container = document.getElementById('waterReviews');
            
            if (!dayData.waterRing) {
                container.innerHTML = '<p style="color: #666;">No Water Ring review for this day</p>';
                return;
            }
            
            const review = dayData.waterRing;
            container.innerHTML = `
                <div class="time-entry">
                    <strong>Review from ${review.timestamp}</strong>
                    <div style="margin-top: 10px;">
                        <strong>Tomorrow's Micro Goals:</strong>
                        <div>${review.microGoals}</div>
                    </div>
                    <div style="margin-top: 10px;">
                        <strong>Adaptations:</strong>
                        <div>${review.adaptations}</div>
                    </div>
                    <div style="margin-top: 10px;">
                        <strong>Small Wins:</strong>
                        <div>${review.smallWins}</div>
                    </div>
                </div>
            `;
        }

        // Fire Ring
        function saveFireRing() {
            const frustrations = document.getElementById('frustrations').value;
            const attackPlan = document.getElementById('attackPlan').value;
            const emotionalNotes = document.getElementById('emotionalNotes').value;
            
            const dateStr = formatDate(selectedDate);
            let dayData = JSON.parse(localStorage.getItem(`musashi_${dateStr}`) || '{}');
            
            dayData.fireRing = {
                frustrations,
                attackPlan,
                emotionalNotes,
                timestamp: new Date().toLocaleString()
            };
            
            localStorage.setItem(`musashi_${dateStr}`, JSON.stringify(dayData));
            
            document.getElementById('frustrations').value = '';
            document.getElementById('attackPlan').value = '';
            document.getElementById('emotionalNotes').value = '';
            
            alert('Fire Ring entry saved!');
            loadFireEntries();
            renderCalendar();
            updateStats();
        }

        function loadFireEntries() {
            const dateStr = formatDate(selectedDate);
            const dayData = JSON.parse(localStorage.getItem(`musashi_${dateStr}`) || '{}');
            const container = document.getElementById('fireEntries');
            
            if (!dayData.fireRing) {
                container.innerHTML = '<p style="color: #666;">No Fire Ring entry for this day</p>';
                return;
            }
            
            const fire = dayData.fireRing;
            container.innerHTML = `
                <div class="time-entry">
                    <strong>Entry from ${fire.timestamp}</strong>
                    <div style="margin-top: 10px;">
                        <strong>Frustrations:</strong>
                        <div>${fire.frustrations}</div>
                    </div>
                    <div style="margin-top: 10px;">
                        <strong>Attack Plan:</strong>
                        <div>${fire.attackPlan}</div>
                    </div>
                    <div style="margin-top: 10px;">
                        <strong>Emotional Notes:</strong>
                        <div>${fire.emotionalNotes}</div>
                    </div>
                </div>
            `;
        }

        // Wind Ring Modal
        function openWindModal() {
            document.getElementById('windModal').style.display = 'block';
        }

        function closeWindModal() {
            document.getElementById('windModal').style.display = 'none';
        }

        function saveWindRing() {
            const complacencyNote = document.getElementById('complacencyNote').value;
            const realization = document.getElementById('windRealization').value;
            
            if (!complacencyNote || !realization) {
                alert('Please fill in both fields');
                return;
            }
            
            const dateStr = formatDate(new Date());
            let dayData = JSON.parse(localStorage.getItem(`musashi_${dateStr}`) || '{}');
            
            if (!dayData.windRing) dayData.windRing = [];
            
            dayData.windRing.push({
                complacencyNote,
                realization,
                timestamp: new Date().toLocaleString()
            });
            
            localStorage.setItem(`musashi_${dateStr}`, JSON.stringify(dayData));
            
            document.getElementById('complacencyNote').value = '';
            document.getElementById('windRealization').value = '';
            
            closeWindModal();
            alert('Wind Ring entry saved!');
            renderCalendar();
            updateStats();
        }

        // Notes viewing
        function loadNotesForDate() {
            const dateStr = document.getElementById('notesDate').value;
            const dayData = JSON.parse(localStorage.getItem(`musashi_${dateStr}`) || '{}');
            const container = document.getElementById('notesDisplay');
            
            if (!Object.keys(dayData).length) {
                container.innerHTML = '<p style="color: #666;">No data for this date</p>';
                return;
            }
            
            let html = `<div class="card"><h3>📅 Notes for ${dateStr}</h3>`;
            
            // Time Entries
            if (dayData.timeEntries && dayData.timeEntries.length > 0) {
                html += `<div style="margin-bottom: 20px;">
                    <h4>🌍 Earth Ring - Time Tracking</h4>`;
                dayData.timeEntries.forEach(entry => {
                    html += `
                        <div class="time-entry">
                            <strong>${entry.fromTime} - ${entry.toTime}: ${entry.activity}</strong>
                            <div>Category: ${entry.category} | Duration: ${Math.floor(entry.duration / 60)}h ${entry.duration % 60}m</div>
                            ${entry.note ? `<div class="note">💡 ${entry.note}</div>` : ''}
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // Water Ring
            if (dayData.waterRing) {
                const water = dayData.waterRing;
                html += `<div style="margin-bottom: 20px;">
                    <h4>💧 Water Ring Review</h4>
                    <div class="time-entry">
                        <div><strong>Micro Goals:</strong> ${water.microGoals}</div>
                        <div style="margin-top: 10px;"><strong>Adaptations:</strong> ${water.adaptations}</div>
                        <div style="margin-top: 10px;"><strong>Small Wins:</strong> ${water.smallWins}</div>
                    </div>
                </div>`;
            }
            
            // Fire Ring
            if (dayData.fireRing) {
                const fire = dayData.fireRing;
                html += `<div style="margin-bottom: 20px;">
                    <h4>🔥 Fire Ring Entry</h4>
                    <div class="time-entry">
                        <div><strong>Frustrations:</strong> ${fire.frustrations}</div>
                        <div style="margin-top: 10px;"><strong>Attack Plan:</strong> ${fire.attackPlan}</div>
                        <div style="margin-top: 10px;"><strong>Emotional Notes:</strong> ${fire.emotionalNotes}</div>
                    </div>
                </div>`;
            }
            
            // Wind Ring
            if (dayData.windRing && dayData.windRing.length > 0) {
                html += `<div style="margin-bottom: 20px;">
                    <h4>💨 Wind Ring Entries</h4>`;
                dayData.windRing.forEach((wind, index) => {
                    html += `
                        <div class="time-entry">
                            <strong>Entry ${index + 1} (${wind.timestamp})</strong>
                            <div style="margin-top: 10px;"><strong>Complacency:</strong> ${wind.complacencyNote}</div>
                            <div style="margin-top: 10px;"><strong>Realization:</strong> ${wind.realization}</div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Stats and analytics
        function updateStats() {
            const allData = getAllStoredData();
            
            // Total days tracked
            document.getElementById('totalDays').textContent = allData.length;
            
            // Average productivity
            let totalTime = 0;
            let productiveTime = 0;
            let goalCount = 0;
            let windCount = 0;
            
            allData.forEach(({ data }) => {
                if (data.timeEntries) {
                    data.timeEntries.forEach(entry => {
                        totalTime += entry.duration;
                        if (entry.category === 'productive') {
                            productiveTime += entry.duration;
                        }
                    });
                }
                
                if (data.waterRing && data.waterRing.microGoals) {
                    goalCount++;
                }
                
                if (data.windRing) {
                    windCount += data.windRing.length;
                }
            });
            
            const avgProductivity = totalTime > 0 ? Math.round((productiveTime / totalTime) * 100) : 0;
            document.getElementById('avgProductivity').textContent = avgProductivity + '%';
            document.getElementById('totalGoals').textContent = goalCount;
            document.getElementById('windEntries').textContent = windCount;
        }

        function getAllStoredData() {
            const keys = Object.keys(localStorage).filter(key => key.startsWith('musashi_'));
            return keys.map(key => ({
                date: key.replace('musashi_', ''),
                data: JSON.parse(localStorage.getItem(key))
            })).sort((a, b) => new Date(b.date) - new Date(a.date));
        }

        // Load today's data into forms
        function loadTodaysData() {
            loadTimeEntries();
            loadWaterReviews();
            loadFireEntries();
            
            const dateStr = formatDate(selectedDate);
            const dayData = JSON.parse(localStorage.getItem(`musashi_${dateStr}`) || '{}');
            
            // Pre-fill forms if data exists
            if (dayData.waterRing) {
                document.getElementById('microGoals').value = dayData.waterRing.microGoals || '';
                document.getElementById('adaptations').value = dayData.waterRing.adaptations || '';
                document.getElementById('smallWins').value = dayData.waterRing.smallWins || '';
            }
            
            if (dayData.fireRing) {
                document.getElementById('frustrations').value = dayData.fireRing.frustrations || '';
                document.getElementById('attackPlan').value = dayData.fireRing.attackPlan || '';
                document.getElementById('emotionalNotes').value = dayData.fireRing.emotionalNotes || '';
            }
        }

        // Utility functions
        window.onclick = function(event) {
            const modal = document.getElementById('windModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // Export data function (bonus feature)
        function exportData() {
            const allData = getAllStoredData();
            const dataStr = JSON.stringify(allData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `musashi_data_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // Add export button to calendar tab
        document.addEventListener('DOMContentLoaded', function() {
            const calendarTab = document.getElementById('calendar');
            const exportBtn = document.createElement('button');
            exportBtn.className = 'btn';
            exportBtn.textContent = '📤 Export Data';
            exportBtn.onclick = exportData;
            exportBtn.style.position = 'fixed';
            exportBtn.style.bottom = '20px';
            exportBtn.style.right = '20px';
            exportBtn.style.zIndex = '999';
            document.body.appendChild(exportBtn);
        });
    </script>
</body>
</html>